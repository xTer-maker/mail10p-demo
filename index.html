<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Mail 10 phút — Demo (mail.tm)</title>
<link rel="icon" href="data:,">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<!-- Tải Tailwind CSS để tạo giao diện hiện đại, dễ tùy chỉnh và có tính đáp ứng (responsive) -->
<script src="https://cdn.tailwindcss.com"></script>
<script>
  tailwind.config = {
    theme: {
      extend: {
        fontFamily: {
          sans: ['Inter', 'system-ui', 'Segoe UI', 'Roboto', 'Arial']
        },
        colors: {
          'bg-dark': '#0b1220',
          'card-dark': '#0f1724',
          'muted-text': '#9aa4b2',
          'accent': '#3b82f6',
          'glass': 'rgba(255, 255, 255, 0.03)',
          'success': '#22c55e',
          'danger': '#ef4444',
          'primary-gradient': 'linear-gradient(90deg, #3b82f6, #60a5fa)',
          'danger-gradient': 'linear-gradient(90deg, #ef4444, #f87171)',
        }
      }
    }
  }
</script>
<style>
  /* Thiết lập font và màu nền */
  body {
    background: linear-gradient(180deg, #071021 0%, #041022 100%);
    color: #e6eef6;
    min-height: 100vh;
    font-family: 'Inter', system-ui, 'Segoe UI', Roboto, Arial, sans-serif;
  }
  /* Cải thiện thanh cuộn cho các khu vực cuộn */
  ::-webkit-scrollbar {
    width: 6px;
    height: 6px;
  }
  ::-webkit-scrollbar-track {
    background: transparent;
  }
  ::-webkit-scrollbar-thumb {
    background-color: rgba(255, 255, 255, 0.1);
    border-radius: 9999px;
  }
  ::-webkit-scrollbar-thumb:hover {
    background-color: rgba(255, 255, 255, 0.2);
  }
  /* Thiết lập kiểu nút với gradient tùy chỉnh */
  .btn-primary {
    background: linear-gradient(90deg, #3b82f6, #60a5fa);
    border: none;
  }
  .btn-danger {
    background: linear-gradient(90deg, #ef4444, #f87171);
    border: none;
  }
</style>
</head>
<body class="p-4 sm:p-6 md:p-8">
  <!-- Container chính của ứng dụng, căn giữa và giới hạn chiều rộng trên desktop -->
  <div class="max-w-7xl mx-auto">
    <header class="flex items-center gap-4 mb-6 md:mb-8">
      <div>
        <h1 class="text-2xl font-bold text-white">Mail 10 phút — mail.tm (Demo)</h1>
        <p class="text-sm text-muted-text mt-1">Email tạm — tự tạo, lưu local, tự đổi sau 10 phút. Không cần server.</p>
      </div>
    </header>

    <!-- Thẻ top-card chứa ô nhập email và các nút điều khiển -->
    <div class="bg-card-dark p-4 rounded-xl shadow-lg border border-gray-800 flex flex-col md:flex-row items-start md:items-center gap-4 md:gap-6">
      <!-- Khu vực nhập email và các nút chính -->
      <div class="flex-1 w-full md:w-auto flex flex-col sm:flex-row items-center gap-2 sm:gap-4">
        <!-- Ô nhập email giờ có thể tự điều chỉnh kích thước, tránh tràn trên di động -->
        <input id="emailInput" type="text" readonly placeholder="Nhấn 'Tạo mới' để tạo email" class="flex-1 w-full min-w-0 bg-transparent border border-gray-700 text-white rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-accent" />
        <div class="flex items-center gap-2 w-full sm:w-auto">
            <button id="btnCopy" class="bg-gray-800 hover:bg-gray-700 text-white font-medium py-2 px-4 rounded-lg transition-colors duration-200">Sao chép</button>
            <button id="btnNew" class="btn-primary text-white font-semibold py-2 px-4 rounded-lg transition-shadow duration-200 shadow-md hover:shadow-lg">Tạo mới</button>
        </div>
        <div class="text-sm text-muted-text mt-2 sm:mt-0 whitespace-nowrap">Hết hạn trong <span id="countdown" class="font-medium text-white">—</span></div>
      </div>

      <!-- Khu vực các nút điều khiển phụ -->
      <div class="flex flex-col sm:flex-row items-center justify-end gap-3 mt-4 md:mt-0">
        <div class="flex items-center gap-2 text-sm text-muted-text">
          <label class="whitespace-nowrap">Auto refresh</label>
          <select id="autoRef" title="Tự động lấy inbox" class="bg-gray-800 border border-gray-700 text-white rounded-lg px-2 py-1.5 focus:outline-none focus:ring-2 focus:ring-accent">
            <option value="0">Tắt</option>
            <option value="5">5s</option>
            <option value="10" selected>10s</option>
            <option value="30">30s</option>
            <option value="60">60s</option>
          </select>
        </div>
        <div class="flex items-center gap-2">
          <button id="btnRefresh" class="bg-gray-800 hover:bg-gray-700 text-white font-medium py-2 px-4 rounded-lg transition-colors duration-200">Làm mới</button>
          <button id="btnForceNew" class="btn-danger text-white font-semibold py-2 px-4 rounded-lg transition-shadow duration-200 shadow-md hover:shadow-lg">Force mới</button>
        </div>
      </div>
    </div>

    <!-- Bố cục chính với 2 cột trên desktop và 1 cột trên di động -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-6">
      <!-- Panel Hộp thư đến (chiếm 1/3 trên desktop) -->
      <div class="bg-card-dark p-4 rounded-xl shadow-lg border border-gray-800 md:col-span-1">
        <div class="flex justify-between items-center mb-4">
          <div class="flex items-center gap-2">
            <span class="bg-gray-800 text-white text-sm font-medium px-2.5 py-1.5 rounded-full">Hộp thư</span>
            <div id="emailStatus" class="text-sm text-muted-text">—</div>
          </div>
          <div class="text-sm text-muted-text">Số thư: <span id="countNum" class="font-medium text-white">0</span></div>
        </div>
        
        <!-- Danh sách thư đến, có thể cuộn -->
        <div class="inbox-list overflow-y-auto max-h-[calc(100vh-28rem)] space-y-2 pr-2" id="msgList">
          <div id="emptyHint" class="text-sm text-muted-text text-center py-4">Chưa có thư — gửi mail vào địa chỉ của bạn rồi nhấn "Làm mới".</div>
        </div>
      </div>
      
      <!-- Panel Xem nội dung thư (chiếm 2/3 trên desktop) -->
      <div class="bg-card-dark p-4 rounded-xl shadow-lg border border-gray-800 md:col-span-2 flex flex-col">
        <div class="flex flex-col gap-2 mb-4">
          <div id="meta" class="text-sm text-muted-text">Chưa chọn thư</div>
          <div class="flex items-center gap-2">
            <button id="btnOpenRaw" class="bg-gray-800 hover:bg-gray-700 text-white font-medium py-2 px-4 rounded-lg text-sm transition-colors duration-200">Xem raw</button>
            <button id="btnOpenIframe" class="bg-gray-800 hover:bg-gray-700 text-white font-medium py-2 px-4 rounded-lg text-sm transition-colors duration-200">Xem HTML (safe)</button>
          </div>
        </div>
        <!-- Khu vực hiển thị nội dung thư, có thể cuộn -->
        <div id="content" class="flex-1 bg-gray-800 p-4 rounded-lg text-sm overflow-y-auto">
          <div class="text-muted-text">Chọn 1 thư để xem nội dung</div>
        </div>
      </div>
    </div>

    <footer class="mt-6 text-center text-xs text-muted-text">
      <div>Lưu ý: demo dùng <strong>mail.tm</strong>. API có thể giới hạn request. Không dùng cho thông tin quan trọng.</div>
    </footer>
  </div>

<script>
/*
  Mail 10 phút - single file
  - Dùng mail.tm API
  - Lưu local: {address,password,createdAt,expiresAt,token}
  - Tự tạo mới sau EXPIRE_MS
  - Auto-refresh inbox
  - Hiển thị mail HTML trong iframe (sandbox, no scripts)
*/

const API = 'https://api.mail.tm';
const EXPIRE_MS = 10 * 60 * 1000; // 10 phút
const LS_KEY = 'temp_mail_tm_v1';

const el = {
  emailInput: document.getElementById('emailInput'),
  btnCopy: document.getElementById('btnCopy'),
  btnNew: document.getElementById('btnNew'),
  btnForceNew: document.getElementById('btnForceNew'),
  btnRefresh: document.getElementById('btnRefresh'),
  autoRef: document.getElementById('autoRef'),
  countdown: document.getElementById('countdown'),
  msgList: document.getElementById('msgList'),
  content: document.getElementById('content'),
  meta: document.getElementById('meta'),
  countNum: document.getElementById('countNum'),
  emailStatus: document.getElementById('emailStatus'),
  btnOpenRaw: document.getElementById('btnOpenRaw'),
  btnOpenIframe: document.getElementById('btnOpenIframe'),
  emptyHint: document.getElementById('emptyHint'),
};

let state = {
  address: '',
  password: '',
  token: '',
  createdAt: 0,
  expiresAt: 0,
  messages: [],
  selectedId: null
};

let timers = {
  countdown: null,
  autoRefresh: null
};

// Hàm lưu trạng thái vào localStorage
function saveState(){
  localStorage.setItem(LS_KEY, JSON.stringify({
    address: state.address,
    password: state.password,
    token: state.token,
    createdAt: state.createdAt,
    expiresAt: state.expiresAt
  }));
}

// Hàm tải trạng thái từ localStorage
function loadState(){
  const raw = localStorage.getItem(LS_KEY);
  if(!raw) return false;
  try{
    const s = JSON.parse(raw);
    if(s && s.address && s.password && s.createdAt && s.expiresAt){
      state.address = s.address;
      state.password = s.password;
      state.token = s.token || '';
      state.createdAt = s.createdAt;
      state.expiresAt = s.expiresAt;
      return true;
    }
  }catch(e){ console.warn('ls parse error', e) }
  return false;
}

function clearState(){
  localStorage.removeItem(LS_KEY);
  state = { address:'', password:'', token:'', createdAt:0, expiresAt:0, messages:[], selectedId:null };
  renderEmailEmpty();
}

function renderEmail(){
  el.emailInput.value = state.address || '';
  el.emailStatus.textContent = state.address ? `Tạo: ${new Date(state.createdAt).toLocaleTimeString()} ` : '—';
  startCountdown();
}

function renderEmailEmpty(){
  el.emailInput.value = '';
  el.emailStatus.textContent = '—';
  el.countdown.textContent = '—';
  stopCountdown();
  state.messages = [];
  renderList();
  el.content.innerHTML = '<div class="text-muted-text">Chưa có email</div>';
  el.countNum.textContent = '0';
}

function startCountdown(){
  stopCountdown();
  function tick(){
    if(!state.expiresAt){ el.countdown.textContent = '—'; return; }
    const rem = state.expiresAt - Date.now();
    if(rem <= 0){
      el.countdown.textContent = 'Đã hết hạn';
      // Tự động tạo email mới khi hết hạn
      createOrRenew(true);
      return;
    }
    const mm = Math.floor(rem/60000);
    const ss = Math.floor((rem%60000)/1000);
    el.countdown.textContent = `${mm}m ${ss}s`;
  }
  tick();
  timers.countdown = setInterval(tick, 1000);
}

function stopCountdown(){ if(timers.countdown){ clearInterval(timers.countdown); timers.countdown=null; } }

async function apiFetch(path, opts = {}){
  try{
    const r = await fetch(API + path, opts);
    if(!r.ok) {
      const txt = await r.text().catch(()=>'');
      const err = new Error('API lỗi: ' + r.status + ' ' + txt);
      err.status = r.status;
      throw err;
    }
    return await r.json();
  }catch(e){
    throw e;
  }
}

async function createAccountAttempt(){
  // get domain
  const dom = await apiFetch('/domains');
  const domain = dom['hydra:member'] && dom['hydra:member'][0] && dom['hydra:member'][0].domain;
  if(!domain) throw new Error('Không lấy được domain mail.tm');
  const name = 'u' + Math.random().toString(36).slice(2,10);
  const address = `${name}@${domain}`;
  const password = 'p' + Math.random().toString(36).slice(2,12);
  // try create
  try{
    await apiFetch('/accounts', {
      method:'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({address, password})
    });
  }catch(e){
    // if 422 or 409, ignore and try login anyway
    if(e.status && (e.status === 422 || e.status === 409)){
      // continue to token request
    } else {
      // other error -> rethrow
      console.warn('create account error', e);
      throw e;
    }
  }
  // get token
  const tokenRes = await apiFetch('/token', {
    method:'POST', headers:{'Content-Type':'application/json'},
    body: JSON.stringify({address, password})
  });
  return { address, password, token: tokenRes.token };
}

async function createOrRenew(force=false){
  // nếu email còn hiệu lực và không ép buộc tạo mới thì không làm gì
  if(!force && state.address && state.expiresAt > Date.now()){
    console.log('still valid, skipping create');
    return;
  }
  try{
    const acc = await createAccountAttempt();
    state.address = acc.address;
    state.password = acc.password;
    state.token = acc.token;
    state.createdAt = Date.now();
    state.expiresAt = Date.now() + EXPIRE_MS;
    saveState(); // Lưu trạng thái mới vào localStorage
    renderEmail();
    await fetchInbox();
    return true;
  }catch(e){
    console.error('Tạo tài khoản lỗi:', e);
    const customAlert = document.createElement('div');
    customAlert.className = 'fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50';
    customAlert.innerHTML = `
      <div class="bg-gray-900 p-6 rounded-xl shadow-xl text-white max-w-sm">
        <h3 class="text-lg font-bold mb-2">Lỗi</h3>
        <p class="text-sm">${escapeHtml('Không tạo được email mới. Vui lòng kiểm tra kết nối hoặc API bị giới hạn.')}</p>
        <button onclick="this.closest('.fixed').remove()" class="mt-4 bg-accent hover:bg-blue-600 text-white font-medium py-2 px-4 rounded-lg w-full transition-colors duration-200">Đóng</button>
      </div>
    `;
    document.body.appendChild(customAlert);
    return false;
  }
}

async function ensureToken(){
  // Nếu token trống, thử đăng nhập lại bằng mật khẩu đã lưu
  if(state.token) return true;
  if(!state.address || !state.password) return false;
  try{
    const tokenRes = await apiFetch('/token', {
      method:'POST', headers:{'Content-Type':'application/json'},
      body: JSON.stringify({address: state.address, password: state.password})
    });
    state.token = tokenRes.token;
    saveState(); // Cập nhật token mới
    return true;
  }catch(e){
    console.warn('re-login failed', e);
    return false;
  }
}

async function fetchInbox(){
  if(!state.address) return;
  const ok = await ensureToken();
  if(!ok) { console.warn('token not available'); return; }
  try{
    const msgs = await apiFetch('/messages', { headers: { Authorization: 'Bearer ' + state.token }});
    state.messages = msgs['hydra:member'] || [];
    renderList();
  }catch(e){
    console.error('fetchInbox error', e);
    // thử đăng nhập lại 1 lần nếu lỗi
    const relog = await ensureToken();
    if(relog) return fetchInbox();
    el.msgList.innerHTML = `<div class="text-sm text-muted-text text-center py-4">Lỗi khi lấy inbox: ${escapeHtml(e.message)}</div>`;
  }
}

function renderList(){
  const list = state.messages.sort((a,b)=> new Date(b.createdAt) - new Date(a.createdAt));
  el.msgList.innerHTML = '';
  if(list.length === 0){
    el.emptyHint.style.display = 'block';
    el.countNum.textContent = '0';
    return;
  }
  el.emptyHint.style.display = 'none';
  el.countNum.textContent = String(list.length);
  list.forEach(m=>{
    const div = document.createElement('div');
    div.className = `p-3 rounded-lg cursor-pointer transition-colors duration-150 ${state.selectedId === m.id ? 'bg-blue-900 border border-blue-600' : 'bg-gray-800 hover:bg-gray-700'}`;
    div.innerHTML = `
      <h4 class="text-sm font-semibold text-white truncate">${escapeHtml(m.subject||'(No subject)')}</h4>
      <p class="text-xs text-muted-text mt-1 truncate">${escapeHtml(m.from && m.from.address ? m.from.address : '(unknown)')} · ${escapeHtml(new Date(m.createdAt).toLocaleString())}</p>
    `;
    div.onclick = ()=> selectMessage(m.id);
    el.msgList.appendChild(div);
  });
}

async function selectMessage(id){
  state.selectedId = id;
  renderList(); // đánh dấu thư đã chọn
  // lấy nội dung thư
  try{
    const m = await apiFetch(`/messages/${id}`, { headers: { Authorization: 'Bearer ' + state.token }});
    showMessage(m);
  }catch(e){
    console.error('read msg error', e);
    el.content.innerHTML = `<div class="text-sm text-muted-text">Lỗi khi đọc thư: ${escapeHtml(e.message)}</div>`;
  }
}

function showMessage(m){
  el.meta.innerHTML = `<strong>From:</strong> ${escapeHtml(m.from && m.from.address)} &nbsp; <strong>To:</strong> ${escapeHtml(m.to && m.to.address)} <br>
                      <span class="text-xs text-muted-text">${escapeHtml(new Date(m.createdAt).toLocaleString())} · ID:${m.id}</span>`;
  // Xóa nội dung cũ
  el.content.innerHTML = '';
  // Nếu có nội dung HTML, hiển thị trong iframe an toàn
  if(m.html){
    const iframe = document.createElement('iframe');
    iframe.style.width = '100%';
    iframe.style.minHeight = '220px';
    iframe.style.height = '100%';
    iframe.style.border = 'none';
    iframe.style.backgroundColor = 'transparent';
    iframe.setAttribute('sandbox', '');
    const safeHtml = String(m.html).replace(/<script[\s\S]*?<\/script>/gi, '');
    iframe.srcdoc = `
      <!doctype html>
      <html>
      <head>
        <style>
          body { font-family: 'Inter', sans-serif; color: #e6eef6; background-color: transparent; padding: 1rem; }
          img { max-width: 100%; height: auto; }
        </style>
      </head>
      <body>${safeHtml}</body>
      </html>
    `;
    el.content.appendChild(iframe);
  } else {
    // Nếu không có HTML, hiển thị nội dung văn bản thuần
    const pre = document.createElement('pre');
    pre.className = "whitespace-pre-wrap break-words font-sans text-white";
    pre.textContent = m.text || '(No content)';
    el.content.appendChild(pre);
  }
}

function escapeHtml(s){
  if(!s) return '';
  return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#39;');
}

// Xử lý sự kiện
el.btnNew.addEventListener('click', ()=> createOrRenew(true));
el.btnForceNew.addEventListener('click', ()=>{
  const customConfirm = document.createElement('div');
  customConfirm.className = 'fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50';
  customConfirm.innerHTML = `
    <div class="bg-gray-900 p-6 rounded-xl shadow-xl text-white max-w-sm">
      <h3 class="text-lg font-bold mb-2">Xác nhận</h3>
      <p class="text-sm">Force tạo email mới — email hiện tại (nếu có) sẽ không còn dùng được nữa. Tiếp tục?</p>
      <div class="flex gap-2 mt-4">
        <button onclick="this.closest('.fixed').remove()" class="bg-gray-800 hover:bg-gray-700 text-white font-medium py-2 px-4 rounded-lg flex-1">Hủy</button>
        <button id="confirmForceNewBtn" class="btn-danger text-white font-medium py-2 px-4 rounded-lg flex-1">Tiếp tục</button>
      </div>
    </div>
  `;
  document.body.appendChild(customConfirm);

  document.getElementById('confirmForceNewBtn').addEventListener('click', () => {
    customConfirm.remove();
    clearState();
    createOrRenew(true);
  });
});

el.btnCopy.addEventListener('click', ()=>{
  if(!state.address) {
    const customAlert = document.createElement('div');
    customAlert.className = 'fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50';
    customAlert.innerHTML = `
      <div class="bg-gray-900 p-6 rounded-xl shadow-xl text-white max-w-sm">
        <h3 class="text-lg font-bold mb-2">Thông báo</h3>
        <p class="text-sm">Chưa có email để sao chép.</p>
        <button onclick="this.closest('.fixed').remove()" class="mt-4 bg-accent hover:bg-blue-600 text-white font-medium py-2 px-4 rounded-lg w-full transition-colors duration-200">Đóng</button>
      </div>
    `;
    document.body.appendChild(customAlert);
    return;
  }
  // Sử dụng document.execCommand thay vì navigator.clipboard để tương thích tốt hơn với iframe
  const tempInput = document.createElement('input');
  document.body.appendChild(tempInput);
  tempInput.value = state.address;
  tempInput.select();
  document.execCommand('copy');
  document.body.removeChild(tempInput);

  const t = document.createElement('span'); 
  t.textContent='Đã sao chép'; 
  t.className = 'text-success text-sm ml-2';
  el.btnCopy.parentNode.insertBefore(t, el.btnCopy.nextSibling);
  setTimeout(()=>t.remove(),1500);
});

el.btnRefresh.addEventListener('click', ()=> fetchInbox());
el.autoRef.addEventListener('change', ()=>{
  const v = Number(el.autoRef.value);
  if(timers.autoRefresh){ clearInterval(timers.autoRefresh); timers.autoRefresh=null; }
  if(v > 0){
    timers.autoRefresh = setInterval(()=> {
      if(state.address) fetchInbox();
    }, v*1000);
  }
});

// Mở nội dung thư dạng raw hoặc iframe
el.btnOpenRaw.addEventListener('click', ()=>{
  if(!state.selectedId) {
    const customAlert = document.createElement('div');
    customAlert.className = 'fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50';
    customAlert.innerHTML = `
      <div class="bg-gray-900 p-6 rounded-xl shadow-xl text-white max-w-sm">
        <h3 class="text-lg font-bold mb-2">Thông báo</h3>
        <p class="text-sm">Chưa chọn thư để xem.</p>
        <button onclick="this.closest('.fixed').remove()" class="mt-4 bg-accent hover:bg-blue-600 text-white font-medium py-2 px-4 rounded-lg w-full transition-colors duration-200">Đóng</button>
      </div>
    `;
    document.body.appendChild(customAlert);
    return;
  }
  window.open(`${API}/messages/${state.selectedId}`, '_blank');
});
el.btnOpenIframe.addEventListener('click', ()=>{
  if(!state.selectedId) {
    const customAlert = document.createElement('div');
    customAlert.className = 'fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50';
    customAlert.innerHTML = `
      <div class="bg-gray-900 p-6 rounded-xl shadow-xl text-white max-w-sm">
        <h3 class="text-lg font-bold mb-2">Thông báo</h3>
        <p class="text-sm">Chưa chọn thư để xem.</p>
        <button onclick="this.closest('.fixed').remove()" class="mt-4 bg-accent hover:bg-blue-600 text-white font-medium py-2 px-4 rounded-lg w-full transition-colors duration-200">Đóng</button>
      </div>
    `;
    document.body.appendChild(customAlert);
    return;
  }
  selectMessage(state.selectedId);
});

// Khởi chạy ứng dụng
(async function init(){
  const ok = loadState(); // Tải trạng thái từ localStorage
  if(ok){
    // nếu đã hết hạn, tạo mới
    if(state.expiresAt <= Date.now()){
      await createOrRenew(true);
    } else {
      // nếu còn hiệu lực, cố gắng đăng nhập lại để lấy token mới (nếu cần) và tải inbox
      await ensureToken();
      renderEmail();
      await fetchInbox();
    }
  } else {
    // Nếu chưa có dữ liệu lưu, tạo tài khoản mới
    await createOrRenew(true);
  }

  // Bắt đầu tự động làm mới theo lựa chọn đã lưu trong DOM
  const v = Number(el.autoRef.value);
  if(v>0){
    timers.autoRefresh = setInterval(()=> { if(state.address) fetchInbox(); }, v*1000);
  }

})();
</script>
</body>
</html>
